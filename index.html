<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Tour 360 básico</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  </head>
  <body>
    <video id="video360" src="video/Video1.mp4" preload="auto" crossorigin="anonymous" playsinline webkit-playsinline visible="false"></video>

    <a-scene>
      <!-- Cámara con cursor para detectar clics -->
      <a-entity camera look-controls 
                raycaster="objects: .clickable" 
                cursor="rayOrigin: mouse">
      </a-entity>

      <a-plane id="video-screen"
         position="1.23 -0.26 -2"
         rotation="0 -25 0"
         width="1.36" height="0.8"
         material="shader: flat; src: #video360"
         visible="false"
         class="clickable"
         play-video-on-click>
</a-plane>

      <!-- Cielo donde se cargan las imágenes 360 -->
      <a-sky id="sky" src="imagenes/point4.JPG" rotation="0 -90 0"></a-sky>

      <!-- HOTSPOTS -->
      <a-entity id="to-panorama1" geometry="primitive: plane; height: 1.2; width: 1" "  material="color: green; opacity: 0; transparent: true; side: double" position="-1 0.1 -3.2">
              
      </a-entity>
      <a-entity id="to-panorama2" geometry="primitive: plane; height: 3; width: 1.05" "  material="color: yellow; opacity: 0; transparent: true; side: double" position="-1 0.1 -3.2">
        
      </a-entity>

      <a-entity id="to-panorama3" geometry="primitive: plane; height: 1.2; width: 0.6" "  material="color: orange; opacity: 0; transparent: true; side: double"  position="1.941 -0.5 -2.6" visible="false">
        
      </a-entity>

      <a-entity id="to-panorama4" geometry="primitive: plane; height: 3; width: 3.5" "  material="color: pink; opacity: 0; transparent: true; side: double" position="1 -0.5 -2" visible="false">
        
      </a-entity>

      <a-entity id="to-panorama5" geometry="primitive: plane; height: 3; width: 3.5" "  material="color: brown; opacity: 0; transparent: true; side: double" position="3 0 -5" visible="false">
        
      </a-entity>

      <a-entity id="to-panorama6" geometry="primitive: plane; height: 2; width: 4" "  material="color: blue; opacity: 0; transparent: true; side: double" position="3 0.08 -5" visible="false">
        
      </a-entity>
    </a-scene>

    <script>

      const hotspots = {
        point1: document.querySelector('#to-panorama1'),
        point2: document.querySelector('#to-panorama2'),
        point3: document.querySelector('#to-panorama3'),
        point4: document.querySelector('#to-panorama4'),
        point5: document.querySelector('#to-panorama5'),
        point6: document.querySelector('#to-panorama6')
      };

      Object.entries(hotspots).forEach(([key, el]) => {
        el.classList.add('clickable');
        el.addEventListener('click', () => changeScene(key));
      });

  

      function getPanoramaName(src) {
        return src.split('/').pop().replace('.JPG', '');
      }

      function changeScene(panorama) {
        const sky = document.querySelector('#sky');
        sky.setAttribute('src', `imagenes/${panorama}.JPG`);
      }

   

      function mostrarHotspots(configs = []) {
  Object.entries(hotspots).forEach(([key, el]) => {
    const config = configs.find(cfg => cfg.id === key);
    const activo = !!config;

    el.setAttribute('visible', activo);
    el.classList.toggle('clickable', activo);

    if (activo) {
      if (config.position) {
        el.setAttribute('position', config.position);
      }
      if (config.rotation) {
        el.setAttribute('rotation', config.rotation);
      }
      if (Array.isArray(config.size) && config.size.length === 2) {
        el.setAttribute('geometry', {
          width: config.size[0],
          height: config.size[1]
        });
      }
    }
  });
}
      function showVideo(visible) {
        if (visible) {
          const screen = document.querySelector('#video-screen');
          screen.setAttribute('visible', true);
          screen.classList.add("clickable");
          document.querySelector('#video360').pause();
        } else {
          const screen = document.querySelector('#video-screen');
          screen.setAttribute('visible', false);
          screen.classList.remove("clickable");
          document.querySelector('#video360').pause();
        }
      }

      function onChangeScene() {
        const sky = document.querySelector('#sky');
        const src = sky.getAttribute('src');
        const panorama = getPanoramaName(src);

        switch (panorama) {
          case 'point1':
          mostrarHotspots([
              { id: 'point2', position: '-1 0 -3', rotation: '0 0 0' },
              { id: 'point3', position: '0 0.1 -2', rotation: '0 0 0' },
              { id: 'point6', position: '3 0 -5', rotation: '0 -20 0', size: [3,2] }
            ]);
            showVideo(false);

            break;
          case 'point2':
          mostrarHotspots([
              { id: 'point1', position: '-1.3 0 2',  rotation:'0 -60 0', size:[1.5,2] },
              { id: 'point3', position: '0.3 0.1 -0.5', rotation:'0 -50 0', size:[0.4,0.5] },
              { id: 'point4', position: '2 0.1 -4' },
              { id: 'point6', position: '17 0 -4',  rotation:'0 -70 0', size:[12,8]  }
            ]);
            showVideo(false);
            break;
          case 'point3':
          mostrarHotspots([
              { id: 'point1', position: '-0.168 0 2' },
              { id: 'point2', position: '-0.8 -0.4 2' },
              { id: 'point4', position: '0.6 0 -3', rotation: '0 0 0', size:[3,3] },
              { id: 'point6', position: '9 -0.7 0',rotation: '0 -60 0', size:[5,6] }
            ]);
            showVideo(false);
            break;
          case 'point4':
          mostrarHotspots([
       //       { id: 'point1', position: '1.5 -0.3 6' },
              { id: 'point2', position: '-0.5 -0.6 3.5', rotation: '0 -10 0', size: [1.5, 1]  },
              { id: 'point3', position: '0.6 0 2', rotation: '0 -10 0', size: [1.5, 1] },
              { id: 'point6', position: '15 -2 1.5', rotation: '0 90 0', size: [12, 12] }
            ]);
            showVideo(true);

            break;
          case 'point5':
            mostrarHotspots(['point6']);
            break;
          case 'point6':
          mostrarHotspots([
            { id: 'point4', position: '3 0.5 2', rotation: '0 70 0', size: [4, 3] },
              { id: 'point1', position: '1.3 0 -5', rotation: '0 -5 0', size: [2, 3] },
              { id: 'point3', position: '3 0 -3' }
            ]);
            showVideo(false);
            break;
          default:
            mostrarHotspots([]);
        }
      }

      const sky = document.querySelector('#sky');
      sky.addEventListener('materialtextureloaded', onChangeScene);


      AFRAME.registerComponent('play-video-on-click', {
    init: function () {
      const videoEl = document.querySelector('#video360');
      this.el.addEventListener('click', () => {
        if (!document.querySelector('#video-screen').getAttribute('visible')) return;
        

        if (videoEl.paused) {
          videoEl.play();
        } else {
          videoEl.pause();
        }
      });
    }
  });


  function cambiarOpacidadHotspots(valorOpacidad) {
  Object.values(hotspots).forEach(el => {
    el.setAttribute('material', {
      opacity: valorOpacidad,
      transparent: true
    });
  });
}

cambiarOpacidadHotspots(0.5);
    </script>
  </body>
</html>
