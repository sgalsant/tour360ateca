<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Tour 360 básico</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  </head>
  <body>
    <video id="video360" src="video/video1.mkv" preload="auto" crossorigin="anonymous" playsinline webkit-playsinline></video>

    <a-scene>
      <!-- Cámara con cursor para detectar clics -->
      <a-entity camera look-controls 
                raycaster="objects: .clickable" 
                cursor="rayOrigin: mouse">
      </a-entity>

      <a-plane id="video-screen"
         position="1.2 -0.3 -2"
         rotation="0 -25 0"
         width="1.4" height="0.8"
         material="shader: flat; src: #video360"
         visible="false"
         class="clickable"
         play-video-on-click>
</a-plane>

      <!-- Cielo donde se cargan las imágenes 360 -->
      <a-sky id="sky" src="imagenes/point1.JPG" rotation="0 -90 0"></a-sky>

      <!-- HOTSPOTS -->
      <a-entity id="to-panorama1" geometry="primitive: sphere; radius: 0.1" material="color: green" position="-1 0.1 -3.2">
              <a-text value="1" position="0 0 0.35" align="center" width="10"> </a-text>
      </a-entity>
      <a-entity id="to-panorama2" geometry="primitive: sphere; radius: 0.1" material="color: yellow" position="-1 0.1 -3.2">
        <a-text value="2" position="0.03 0 0.1" align="center" color="black"></a-text>
      </a-entity>

      <a-entity id="to-panorama3" geometry="primitive: sphere; radius: 0.1" material="color: black" position="1.941 -0.5 -2.6" visible="false">
        <a-text value="3" position="0 0 -0.5" align="center" color="yellow" look-at="#camera"></a-text>
      </a-entity>

      <a-entity id="to-panorama4" geometry="primitive: sphere; radius: 0.1" material="color: green" position="1 -0.5 -2" visible="false">
        <a-text value="4" position="0 0.1 -0.10" align="center" color="green" look-at="#camera"></a-text>
      </a-entity>

      <a-entity id="to-panorama5" geometry="primitive: sphere; radius: 0.1" material="color: yellow" position="3 0 -5" visible="false">
        <a-text value="5" position="0 0.5 0" align="center" color="black"></a-text>
      </a-entity>

      <a-entity id="to-panorama6" geometry="primitive: sphere; radius: 0.1" material="color: yellow" position="3 0.08 -5" visible="false">
        <a-text value="6"  position="-0.05 0 0.1" align="center" color="black"></a-text>
      </a-entity>
    </a-scene>

    <script>
      const hotspots = {
        point1: document.querySelector('#to-panorama1'),
        point2: document.querySelector('#to-panorama2'),
        point3: document.querySelector('#to-panorama3'),
        point4: document.querySelector('#to-panorama4'),
        point5: document.querySelector('#to-panorama5'),
        point6: document.querySelector('#to-panorama6')
      };

      Object.entries(hotspots).forEach(([key, el]) => {
        el.classList.add('clickable');
        el.addEventListener('click', () => changeScene(key));
      });

  

      function getPanoramaName(src) {
        return src.split('/').pop().replace('.jpg', '');
      }

      function changeScene(panorama) {
        const sky = document.querySelector('#sky');
        sky.setAttribute('src', `imagenes/${panorama}.jpg`);
      }

   

      function mostrarHotspots(configs = []) {
        Object.entries(hotspots).forEach(([key, el]) => {
          const config = configs.find(cfg => cfg.id === key);
          const activo = !!config;
          el.setAttribute('visible', activo);
          el.classList.toggle('clickable', activo);
          if (activo && config.position) {
            el.setAttribute('position', config.position);
          }
        });
      }

      function onChangeScene() {
        const sky = document.querySelector('#sky');
        const src = sky.getAttribute('src');
        const panorama = getPanoramaName(src);

        switch (panorama) {
          case 'point1':
          mostrarHotspots([
              { id: 'point2', position: '-1 0 -3' },
              { id: 'point3', position: '0 0.1 -2' },
              { id: 'point6', position: '3 0 -5' }
            ]);
            document.querySelector('#video-screen').setAttribute('visible', false);
            document.querySelector('#video360').pause();
            break;
          case 'point2':
          mostrarHotspots([
              { id: 'point1', position: '-1.3 0 2' },
              { id: 'point3', position: '0.2 0.1 -0.3' },
              { id: 'point4', position: '2 0.1 -3' },
              { id: 'point6', position: '4 0 -0.5' }
            ]);
            document.querySelector('#video-screen').setAttribute('visible', false);
            document.querySelector('#video360').pause();
            break;
            
      

          case 'point3':
          mostrarHotspots([
              { id: 'point1', position: '-0.168 -0.3 3' },
              { id: 'point2', position: '-0.8 -0.4 2' },
              { id: 'point4', position: '0.6 0 -3' },
              { id: 'point6', position: '4 -0.7 -0.5' }
            ]);
            document.querySelector('#video-screen').setAttribute('visible', false);
            document.querySelector('#video360').pause();
            break;
          case 'point4':
          mostrarHotspots([
              { id: 'point1', position: '1.5 -0.3 6' },
              { id: 'point2', position: '0.75 -0.3 3.5' },
              { id: 'point3', position: '0.6 0 3' },
              { id: 'point6', position: '15 -2 1.5' }
            ]);
            document.querySelector('#video-screen').setAttribute('visible', true);
            document.querySelector('#video360').pause();

            break;
          case 'point5':
            mostrarHotspots(['point6']);
            break;
          case 'point6':
          mostrarHotspots([
            { id: 'point4', position: '10 0.5 1' },
              { id: 'point1', position: '1.3 0 -5' },
              { id: 'point3', position: '3 0 -3' }
            ]);
            document.querySelector('#video-screen').setAttribute('visible', false);
document.querySelector('#video360').pause();
            break;
          default:
            mostrarHotspots([]);
        }
      }

      const sky = document.querySelector('#sky');
      sky.addEventListener('materialtextureloaded', onChangeScene);


      AFRAME.registerComponent('play-video-on-click', {
    init: function () {
      const videoEl = document.querySelector('#video360');
      this.el.addEventListener('click', () => {
        if (videoEl.paused) {
          videoEl.play();
        } else {
          videoEl.pause();
        }
      });
    }
  });
    </script>
  </body>
</html>
